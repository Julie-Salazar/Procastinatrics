{% extends "base.html" %}

{% block title %}Share Your Shame{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/receipt-styles.css') }}">
{% endblock %}
{% if debug_url is defined %}
<div style="text-align: center; margin-top: 20px;">
    <a href="{{ debug_url }}" target="_blank" style="font-size: 12px; color: #888; text-decoration: none;">Debug Data</a>
</div>
{% endif %}
{% block content %}
<!-- Page Title Header -->
<header class="page-header">
    <h1>Share your shame!✨</h1>
</header>

<!-- Content Container -->
<div class="content-wrapper">
    <!-- Receipt Container -->
    <div class="receipt-container" id="receipt-container">
        <img src="{{ url_for('static', filename='img/receipt-base.svg') }}" alt="receipt" />
        
        
        <!-- Only render receipt text if receipt_data exists -->
        {% if receipt_data is defined %}
        <div class="receipt-text receipt-date-time" style="top: 105px; left: 160px;">
    {{ receipt_data.date }} • {{ receipt_data.time }}
</div>

<div class="receipt-text receipt-number" style="top: 140px; left: 260px;">
     #{{ receipt_data.receipt_number }}
</div>

<div class="receipt-text status-value" style="top: 210px; left: 280px;">
    {{ receipt_data.status }}
</div>

<div class="receipt-text customer-value" style="top: 260px; left: 220px;">
    {{ receipt_data.customer_name }}
</div>

<div class="receipt-text proc-hours-label" style="top: 295px; left: 140px;">
    % TIME RATIO %
</div>

<div class="receipt-text proc-hours-value" style="top: 355px; left: 340px;">
    {{ receipt_data.procrastination_hours }}%
</div>

<div class="receipt-text gaming-hours-value" style="top: 385px; left: 340px;">
    {{ receipt_data.gaming_hours }}%
</div>

<div class="receipt-text productive-hours-value" style="top: 418px; left: 340px;">
    {{ receipt_data.productive_hours }}%
</div>


<div class="receipt-text total-hours-value" style="top: 480px; left: 340px;">
    {{ receipt_data.total_hours }} hrs
</div>

        {% endif %}
    </div>
    

    <!-- Share Options -->
    <section class="share-card">
        <div class="friend-list">
            <div class="search-bar">
                <img src="{{ url_for('static', filename='img/search-icon.svg') }}" alt="Search" class="search-icon">
                <input type="text" id="friend-search" placeholder="Search friends..." aria-label="Search friends">
            </div>

            <ul id="friends-list" style="padding-left: 0;">
                {% for user in users %}
                <li class="friend-item">
                    <div style="display: flex; align-items: center;">
                        <span>{{user.email}}</span>
                    </div>
                    <button class="share-btn" data-user-id="{{ user.uid }}">share</button>
                </li>
                {% else %}
                <li class="friend-item">
                    <span>No users found, sorry... </span>
                </li>
                
                {% endfor %}
            </ul>
        </div>

        <!-- Dropdown Filter -->
        <div class="filter-dropdown">
            <label for="timeframe">Choose a timeframe:</label>
            <select name="timeframe" id="timeframe">
                <option value="daily" {% if timeframe == 'daily' %}selected{% endif %}>Day</option>
                <option value="weekly" {% if timeframe == 'weekly' %}selected{% endif %}>Week</option>
                <option value="monthly" {% if timeframe == 'monthly' %}selected{% endif %}>Month</option>
                <option value="yearly" {% if timeframe == 'yearly' %}selected{% endif %}>Year</option>
            </select>
        </div>

        <!-- Download Button -->
        <div class="download-btn">
            <button class="download-btn-inner" id="download-receipt">
                <img src="{{ url_for('static', filename='img/import-icon.svg') }}" alt="Download" />
                <span>Get PDF Receipt</span>
            </button>
        </div>
    </section>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Add this script just before the closing </body> tag in share.html -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Debug percentage values
    console.log('DEBUG - receipt_data values:');
    console.log({
        procrastination_hours: {{ receipt_data.procrastination_hours|default(0) }},
        gaming_hours: {{ receipt_data.gaming_hours|default(0) }},
        productive_hours: {{ receipt_data.productive_hours|default(0) }},
        total_hours: {{ receipt_data.total_hours|default(0) }}
    });
    
    // Debug the actual DOM elements
    console.log('DEBUG - DOM elements:');
    console.log({
        proc_hours_element: document.querySelector('.proc-hours-value')?.innerText,
        gaming_hours_element: document.querySelector('.gaming-hours-value')?.innerText,
        productive_hours_element: document.querySelector('.productive-hours-value')?.innerText,
        total_hours_element: document.querySelector('.total-hours-value')?.innerText
    });
    
    // Check if the data is actually reaching the template
    const procValue = document.querySelector('.proc-hours-value');
    const gamingValue = document.querySelector('.gaming-hours-value');
    const prodValue = document.querySelector('.productive-hours-value');
    
    if (procValue) procValue.style.backgroundColor = '#ffff0022';
    if (gamingValue) gamingValue.style.backgroundColor = '#ffff0022';
    if (prodValue) prodValue.style.backgroundColor = '#ffff0022';
});
</script>
{% endblock %}  
